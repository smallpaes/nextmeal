language: node_js
node_js:
- 16.17.0
services:
- mysql
env:
  global:
    secure: N4dLAxt9EyGPVE4beALQAsT81Vk+QXElhin+Ny2c71P4FEA99xjJoza8WYWMsSBN4bOgKwMKuUUMZz7toKrLrNRbWpawMBuSBud9wp9g5uwFzNPwQ2sefk4VBEjPevLISKLJtV4bOPn5BJSYLLTKs255DJHpiKjaM6TFK0HsYa0XPcIIF+GxHjOYolTAJwXSwJtuao+EU+PWQ3zw/HOHhg0049bnsSq5B0WiHM7MVazktI0l8xTl6vyjBykoMAMkETkO3LoseGaEcQTrf1ziae7DSK2bs92pHnPmWxawHPnvI9S5lBHq8D5b+ROF9aI8PSuATDRwSbNi7cFuM0ShxrSmBGm/1FQRxEivXrdu+Jmjm5NBTYM/R3t38CLM+79menh0yMCPv1X+Uo/U2Wk9TyxONLMrceudIzd0jTvRCMgMwji7zvJpkOK7SskzQlPhEdLjEYLRiL1UghJi55Mq6AZfsq4+JegeuhuS8vXpu2nNL/M2efZtknY5HvJaVKx/MB6ZVCcnOpJXHam1JawhevGUpPkbq0+HK5zwtzS5u+oYCGwwMQ1uxFteZVrP3l5hZu0X3CtvM2l2PsxDeWDZSwwfWu9iAb5lyvPR/PI1w3benKvjwcHhJ4goykq6hbzhZayg7KHDdddGJnbPxQfvJSYRIrtN4ufys3EIaOS1TO0=
jobs:
  include:
  - stage: server
    env:
    - NODE_ENV=test
    before_install:
    - mysql -e 'CREATE DATABASE IF NOT EXISTS nextMeal_test default character set
      utf8mb4 collate utf8mb4_unicode_ci;'
    - npm install sequelize-cli -g
    before_script:
    - cd server
    - sequelize db:migrate
    script: npm test
  - stage: client
    script:
    - cd ./client
    - npm install
    - npm run build
    - cd ../
    after_success:
    - git add .
    - git commit -m "Travis CI built client for deplotment"
    deploy:
      provider: heroku
      api_key:
        secure: dib5GOKsjsf9n+PZijGofgWs0G4UGxO/gu/2VHbNNaDJdmopQItKlSS8iMfFVFpO/Kf5DKCDPTaBM8XIT8A3WBFq4RD2xje1ZMnuwA4a7XdJiimyujbHvFOMWYjnTAPhLFoReXHrIHzS9NimBxYdXXLtvhEjVwWFIpAIjGJ3b83MAIrZvW45qU6/R8UOuncJCcHqZfHnVsOTNNAXWjSnp22oZwHfGomvcFTC/XH3XjV1sDYo5U4oG8dUMntPpZtY69E4kvKnk2+JaVyc+NfH8QOxZsloZNBoKo7wEu3pJbB9IXp0xp54XH7bhs+wodMO3keoK75Ql8+PwaJ4CQBb3sGylNkhJzD30aIsBIFlFdMkVs7Y7du+bnybEUObCxeSNQ6v5Zw8vpojMmubDbAeJEHf0LyS8+Xf3GrfvidqjK+7hpLYXCgyDCdqQSOtv84JIlTrC+Pvb1z7GD/nubxY03qvhu20QY8Um7dqcIO8bIaHBi6erbnY2qviDhymMiqJnkN1JbP/ffEpIw6LN11iVRO86Wu4N/pevWzgcA/SlKIju6KmlIC6fGinsBaEDXXKMnbnnbM1Qqxqstvp43YJj6e93vBoabWBN1gHaj864kQu1YqYgG9Cd/QhPA4onWURGYM0cRqa4Zv8yC9kvIZ3ULDcntsz4m9JfvWRbW+mThc=
