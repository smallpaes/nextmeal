{"version":3,"sources":["webpack:///./src/views/OrderEdit.vue","webpack:///src/views/OrderEdit.vue","webpack:///./src/views/OrderEdit.vue?5713","webpack:///./src/views/OrderEdit.vue?7841","webpack:///./src/views/OrderEdit.vue?80db"],"names":["render","_vm","this","_c","_self","isLoading","attrs","_e","banner","image","height","scopedSlots","_u","key","fn","staticClass","_v","proxy","order","quantity","meal","orderData","timeSlots","isProcessing","currentUser","on","$event","$router","go","handleAfterSubmit","staticRenderFns","components","UserNavbar","ImageHeaderBanner","MealHorizontalCard","OrderForm","Footer","Loader","data","restaurant","name","rating","description","time","computed","_objectSpread","mapState","created","orderId","$route","params","order_id","fetchOrder","methods","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$orderAPI$getEd","statusText","_data$order","_data$order$meals","requireDate","wrap","_context","prev","next","orderAPI","getEditOrder","sent","status","Error","message","meals","Restaurant","_objectWithoutProperties","_excluded","amount","require_date","time_slots","moment","Date","format","t0","Toast","fire","type","title","push","stop","formData","_this2","_callee2","_yield$orderAPI$putEd","_context2","putEditOrder","$store","commit","component"],"mappings":"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","file":"js/chunk-f58534c0.272fe795.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('section',[_c('UserNavbar'),(_vm.isLoading)?_c('Loader',{attrs:{\"height\":'100vh'}}):_vm._e(),_c('transition',{attrs:{\"name\":\"fade\"}},[(!_vm.isLoading)?_c('header',[_c('ImageHeaderBanner',{attrs:{\"background-photo\":_vm.banner.image,\"banner-height\":_vm.banner.height},scopedSlots:_vm._u([{key:\"header\",fn:function(){return [_c('h1',{staticClass:\"banner-content-title\"},[_vm._v(\" 編輯餐點 \")]),_c('h3',{staticClass:\"banner-content-description\"},[_vm._v(\" 更改數量或領餐時間 \")])]},proxy:true}],null,false,2727127774)})],1):_vm._e()]),_c('transition',{attrs:{\"name\":\"slide\"}},[(!_vm.isLoading)?_c('section',{staticClass:\"order-wrapper\"},[_c('div',{staticClass:\"container order-container\"},[_c('div',{staticClass:\"row order-content p-3\"},[_c('MealHorizontalCard',{staticClass:\"order-display\",attrs:{\"order\":_vm.order}}),_c('OrderForm',{staticClass:\"order-display mt-3\",attrs:{\"order-info\":{quantity: _vm.order.meal.quantity + _vm.order.orderData.quantity, timeSlots: _vm.order.timeSlots},\"initial-order\":_vm.order.orderData,\"initial-processing\":_vm.isProcessing,\"current-user\":_vm.currentUser},on:{\"to-last-page\":function($event){return _vm.$router.go(-1)},\"after-submit\":_vm.handleAfterSubmit},scopedSlots:_vm._u([{key:\"submit\",fn:function(){return [_vm._v(\" 更新訂單 \")]},proxy:true}],null,false,779348833)})],1)])]):_vm._e()]),_c('transition',{attrs:{\"name\":\"fade\"}},[(!_vm.isLoading)?_c('Footer'):_vm._e()],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <section>\n    <!--Navbar-->\n    <UserNavbar />\n    <!--Loader-->\n    <Loader\n      v-if=\"isLoading\"\n      :height=\"'100vh'\"\n    />\n    <!--Header-->\n    <transition name=\"fade\">\n      <header v-if=\"!isLoading\">\n        <ImageHeaderBanner\n          :background-photo=\"banner.image\"\n          :banner-height=\"banner.height\"\n        >\n          <template v-slot:header>\n            <h1 class=\"banner-content-title\">\n              編輯餐點\n            </h1>\n            <h3\n              class=\"banner-content-description\"\n            >\n              更改數量或領餐時間\n            </h3>\n          </template>\n        </ImageHeaderBanner>\n      </header>\n    </transition>\n    <!--Display order form-->\n    <transition name=\"slide\">\n      <section\n        v-if=\"!isLoading\"\n        class=\"order-wrapper\"\n      >\n        <div class=\"container order-container\">\n          <div\n            class=\"row order-content p-3\"\n          >\n            <MealHorizontalCard\n              :order=\"order\"\n              class=\"order-display\"\n            />\n            <OrderForm\n              class=\"order-display mt-3\"\n              :order-info=\"{quantity: order.meal.quantity + order.orderData.quantity, timeSlots: order.timeSlots}\"\n              :initial-order=\"order.orderData\"\n              :initial-processing=\"isProcessing\"\n              :current-user=\"currentUser\"\n              @to-last-page=\"$router.go(-1)\"\n              @after-submit=\"handleAfterSubmit\"\n            >\n              <template #submit>\n                更新訂單\n              </template>\n            </OrderForm>\n          </div>\n        </div>\n      </section>\n    </transition>\n    <!--Footer-->\n    <transition name=\"fade\">\n      <Footer v-if=\"!isLoading\" />\n    </transition>\n  </section>\n</template>\n\n<script>\nimport UserNavbar from '../components/Navbar/UserNavbar'\nimport ImageHeaderBanner from '../components/Banner/ImageHeaderBanner'\nimport MealHorizontalCard from '../components/Card/MealHorizontalCard'\nimport OrderForm from '../components/OrderForm'\nimport Footer from '../components/Footer'\nimport Loader from '../components/Loader'\nimport orderAPI from '../apis/order'\nimport { Toast } from '../utils/helpers'\nimport moment from 'moment'\nimport { mapState } from 'vuex'\n\nexport default {\n  components: {\n    UserNavbar,\n    ImageHeaderBanner,\n    MealHorizontalCard,\n    OrderForm,\n    Footer,\n    Loader\n  },\n  data () {\n    return {\n      banner: {\n        image: 'https://images.pexels.com/photos/775031/pexels-photo-775031.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260',\n        height: 550\n      },\n      order: {\n        restaurant: {\n          name: '',\n          rating: -1\n        },\n        meal: {\n          name: '',\n          description: '',\n          image: '',\n          quantity: -1\n        },\n        orderData: {\n          quantity: -1,\n          time: ''\n        },\n        timeSlots: []\n      },\n      isLoading: true,\n      isProcessing: false\n    }\n  },\n  computed: {\n    ...mapState(['currentUser'])\n  },\n  created () {\n    const { order_id: orderId } = this.$route.params\n    this.fetchOrder(orderId)\n  },\n  methods: {\n    async fetchOrder (orderId) {\n      try {\n        // fetch order data from API\n        const { data, statusText } = await orderAPI.getEditOrder({ orderId })\n        // error handling\n        if (statusText !== 'OK' || data.status !== 'success') throw new Error(data.message)\n        // retrieve data\n        const { order: { meals: { Restaurant: restaurant, ...meal }, amount: quantity, require_date: requireDate }, time_slots: timeSlots } = data\n        const orderData = {\n          quantity,\n          time: moment(new Date(requireDate)).format('HH:mm')\n        }\n\n        // save data\n        this.order = { ...this.order, restaurant, meal, orderData, timeSlots }\n        // update loading status\n        this.isLoading = false\n      } catch (error) {\n        // update loading status\n        this.isLoading = false\n        // fire error messages\n        Toast.fire({\n          type: 'error',\n          title: '無法取得訂單資料，請稍後再試'\n        })\n        // redirect back to order tomorrow page\n        this.$router.push({ name: 'order-tomorrow' })\n      }\n    },\n    async handleAfterSubmit (formData) {\n      try {\n        // send updated order data\n        const { data, statusText } = await orderAPI.putEditOrder({ orderId: this.$route.params.order_id, formData })\n        // error handling\n        if (statusText !== 'OK' || data.status !== 'success') throw new Error(data.message)\n        // update balance to Vuex\n        const quantity = this.order.orderData.quantity - formData.quantity\n        this.$store.commit('updateBalance', quantity)\n        // redirect to order detail pageasx\n        this.$router.push({ name: 'order', params: { order_id: this.$route.params.order_id } })\n      } catch (error) {\n        // update loading status\n        this.isProcessing = false\n        // fire error messages\n        Toast.fire({\n          type: 'error',\n          title: '無法更新訂購資料，請稍後再試'\n        })\n        // redirect back to last page\n        this.$router.go(-1)\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@include slideAnimation;\n@include fadeAnimation;\n\n.order {\n  &-content {\n    position: relative;\n    top: -7rem;\n  }\n\n  &-display {\n    max-width: 760px;\n    margin: 0 auto;\n  }\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OrderEdit.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OrderEdit.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./OrderEdit.vue?vue&type=template&id=de6a903c&scoped=true&\"\nimport script from \"./OrderEdit.vue?vue&type=script&lang=js&\"\nexport * from \"./OrderEdit.vue?vue&type=script&lang=js&\"\nimport style0 from \"./OrderEdit.vue?vue&type=style&index=0&id=de6a903c&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"de6a903c\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OrderEdit.vue?vue&type=style&index=0&id=de6a903c&prod&lang=scss&scoped=true&\""],"sourceRoot":""}